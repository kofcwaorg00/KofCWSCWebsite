alter PROCEDURE [dbo].uspSYS_GetMembers
@LastName nvarchar(50),
@KofCID int
AS
-- exec uspSYS_GetMembers 'philomeno',0
IF (@KofCID = 0 )
BEGIN
	SELECT [MemberID]
      ,mm.[KofCID]
      ,mm.[Prefix]
      ,mm.[PrefixUpdated]
      ,mm.[PrefixUpdatedBy]
      ,mm.[FirstName]
      ,mm.[FirstNameUpdated]
      ,mm.[FirstNameUpdatedBy]
      ,mm.[NickName]
      ,mm.[NickNameUpdated]
      ,mm.[NickNameUpdatedBy]
      ,mm.[MI]
      ,mm.[MIUpdated]
      ,mm.[MIUpdatedBy]
      ,mm.[LastName]
      ,mm.[LastNameUpdated]
      ,mm.[LastNameUpdatedBy]
      ,mm.[Suffix]
      ,mm.[SuffixUpdated]
      ,mm.[SuffixUpdatedBy]
      ,mm.[AddInfo1]
      ,mm.[AddInfo1Updated]
      ,mm.[AddInfo1UpdatedBy]
      ,mm.[Address]
      ,mm.[AddressUpdated]
      ,mm.[AddressUpdatedBy]
      ,mm.[City]
      ,mm.[CityUpdated]
      ,mm.[CityUpdatedBy]
      ,mm.[State]
      ,mm.[StateUpdated]
      ,mm.[StateUpdatedBy]
      ,mm.[PostalCode]
      ,mm.[PostalCodeUpdated]
      ,mm.[PostalCodeUpdatedBy]
      ,mm.[Phone]
      ,mm.[PhoneUpdated]
      ,mm.[PhoneUpdatedBy]
      ,mm.[WifesName]
      ,mm.[WifesNameUpdated]
      ,mm.[WifesNameUpdatedBy]
      ,mm.[AddInfo2]
      ,mm.[AddInfo2Updated]
      ,mm.[AddInfo2UpdatedBy]
      ,mm.[FaxNumber]
      ,mm.[FaxNumberUpdated]
      ,mm.[FaxNumberUpdatedBy]
      ,mm.[Council]
      ,mm.[CouncilUpdated]
      ,mm.[CouncilUpdatedBy]
      ,mm.[Assembly]
      ,mm.[AssemblyUpdated]
      ,mm.[AssemblyUpdatedBy]
      ,mm.[Circle]
      ,mm.[CircleUpdated]
      ,mm.[CircleUpdatedBy]
      ,mm.[Email]
      ,mm.[EmailUpdated]
      ,mm.[EmailUpdatedBy]
      ,mm.[Deceased]
      ,mm.[DeceasedUpdated]
      ,mm.[DeceasedUpdatedBy]
      ,mm.[CellPhone]
      ,mm.[CellPhoneUpdated]
      ,mm.[CellPhoneUpdatedBy]
      ,mm.[LastUpdated]
      ,mm.[SeatedDelegateDay1]
      ,mm.[SeatedDelegateDay2]
      ,mm.[SeatedDelegateDay3]
      ,mm.[PaidMPD]
      ,mm.[Bulletin]
      ,mm.[BulletinUpdated]
      ,mm.[BulletinUpdatedBy]
      ,mm.[UserID]
      ,mm.[Data]
      ,mm.[DataChanged]
      ,mm.[LastLoggedIn]
      ,mm.[CanEditAdmUI]
      ,mm.[DoNotEmail]
      ,mm.[HidePersonalInfo]
      ,mm.[WhyDoNotEmail]
      ,mm.[LastUpdatedBy]
      ,[dbo].[funSYS_GetPhotoURL](mm.KofCID) as ProfilePictureUrl
	  --,au.ProfilePictureUrl
  FROM [dbo].[tbl_MasMembers] mm
  --LEFT OUTER JOIN AspNetUsers au on mm.KofCID=au.KofCMemberID
  WHERE mm.LastName like '%'+@LastName+'%'
  END
  ELSE
  BEGIN
  SELECT [MemberID]
      ,mm.[KofCID]
      ,mm.[Prefix]
      ,mm.[PrefixUpdated]
      ,mm.[PrefixUpdatedBy]
      ,mm.[FirstName]
      ,mm.[FirstNameUpdated]
      ,mm.[FirstNameUpdatedBy]
      ,mm.[NickName]
      ,mm.[NickNameUpdated]
      ,mm.[NickNameUpdatedBy]
      ,mm.[MI]
      ,mm.[MIUpdated]
      ,mm.[MIUpdatedBy]
      ,mm.[LastName]
      ,mm.[LastNameUpdated]
      ,mm.[LastNameUpdatedBy]
      ,mm.[Suffix]
      ,mm.[SuffixUpdated]
      ,mm.[SuffixUpdatedBy]
      ,mm.[AddInfo1]
      ,mm.[AddInfo1Updated]
      ,mm.[AddInfo1UpdatedBy]
      ,mm.[Address]
      ,mm.[AddressUpdated]
      ,mm.[AddressUpdatedBy]
      ,mm.[City]
      ,mm.[CityUpdated]
      ,mm.[CityUpdatedBy]
      ,mm.[State]
      ,mm.[StateUpdated]
      ,mm.[StateUpdatedBy]
      ,mm.[PostalCode]
      ,mm.[PostalCodeUpdated]
      ,mm.[PostalCodeUpdatedBy]
      ,mm.[Phone]
      ,mm.[PhoneUpdated]
      ,mm.[PhoneUpdatedBy]
      ,mm.[WifesName]
      ,mm.[WifesNameUpdated]
      ,mm.[WifesNameUpdatedBy]
      ,mm.[AddInfo2]
      ,mm.[AddInfo2Updated]
      ,mm.[AddInfo2UpdatedBy]
      ,mm.[FaxNumber]
      ,mm.[FaxNumberUpdated]
      ,mm.[FaxNumberUpdatedBy]
      ,mm.[Council]
      ,mm.[CouncilUpdated]
      ,mm.[CouncilUpdatedBy]
      ,mm.[Assembly]
      ,mm.[AssemblyUpdated]
      ,mm.[AssemblyUpdatedBy]
      ,mm.[Circle]
      ,mm.[CircleUpdated]
      ,mm.[CircleUpdatedBy]
      ,mm.[Email]
      ,mm.[EmailUpdated]
      ,mm.[EmailUpdatedBy]
      ,mm.[Deceased]
      ,mm.[DeceasedUpdated]
      ,mm.[DeceasedUpdatedBy]
      ,mm.[CellPhone]
      ,mm.[CellPhoneUpdated]
      ,mm.[CellPhoneUpdatedBy]
      ,mm.[LastUpdated]
      ,mm.[SeatedDelegateDay1]
      ,mm.[SeatedDelegateDay2]
      ,mm.[SeatedDelegateDay3]
      ,mm.[PaidMPD]
      ,mm.[Bulletin]
      ,mm.[BulletinUpdated]
      ,mm.[BulletinUpdatedBy]
      ,mm.[UserID]
      ,mm.[Data]
      ,mm.[DataChanged]
      ,mm.[LastLoggedIn]
      ,mm.[CanEditAdmUI]
      ,mm.[DoNotEmail]
      ,mm.[HidePersonalInfo]
      ,mm.[WhyDoNotEmail]
      ,mm.[LastUpdatedBy]
	  ,au.ProfilePictureUrl
  FROM [dbo].[tbl_MasMembers] mm
  LEFT OUTER JOIN AspNetUsers au on mm.KofCID=au.KofCMemberID
  WHERE mm.KofCID = @KofCID
  END
